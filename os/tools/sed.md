## Linux三剑客之--sed

### 主要用法
- 格式一：`前置命令 | sed [选项] '编辑指令'
- 格式二：`sed [选项] '编辑指令' 文件...`

### 常见命令选项
- `-n`: 屏蔽默认输出(全部文本): 比如`nl test.txt| sed '1,3p'`就会把1-3行重复输出2次，加了`-n`就会只输出1-3行。
- `-i`: 直接修改文件内容
- `-f`: 把sed命令写入文件，当脚本执行
- `-e`: 可指定多个处理动作
- `-r`: 启用扩展的正则表达式，若与其它选项一起使用，应作为首个选项
- `{}`: 组合多个命令，以分号分分隔

### 基本处理动作
> sed中的定址符，即[地址1，[地址2]]，用来指定处理的起止行数。
- 省略定制符的时候，默认逐行处理全部文本
- 地址可表示为文本的行号，或者用来匹配的`/RegExp/`.

- `p`: 打印行: eg: `5,10p`输出5-10行, `5p;10p`输出第5和第10行
- `d`: 删除行：eg: `5,10d`:删除5-10行
- `s`: 字符串替换
	- `s/old/new/`: 将每行的第1个old字符替换成new
	- `s/old/new/3`: 将每行的第3个old替换成new
	- `s/old/new/g`: 将每行的old都替换成new
	- **注意：**s操作的时候`/`可以体化成其它字符的，如`#`、`@`等(特别是当old字符中有`/`的时候就很好用)


## 使用示例
> 注意：示例只做了输出操作，如果想更改原文件，可以加`-i`选项。

### 输出文本
- `sed -n 'p' test.log`: 输出所有行，等同于cat test.log
- `sed -n '5p' test.log`: 输出第5行
- `sed -n '2,5p' test.log`: 输出第2-5行
- `sed -n '5,+5p' test.log`: 输出第5行及其后的5行内容
- `sed -n '/^root/p' /etc/passwd`: 输出以root开头的行
- `sed -n 'p;n' /etc/passwd`: 输出奇数行，n是next表示读入下一行文本（隔行）
- `sed -n 'n;p' /etc/passwd`: 输出偶数行
- `sed -n '6,${n;p}' test.log`: 输出从第6行到尾行的所有偶数行
- `sed -n '$=' test.log`: 输出文件的行数

### 删除文本
- `sed '1,5d' x.log`: 删除第1-5行
- `sed '/err/d` x.log`: 删除包含err的行
- `sed '/ok/!d' x.log`: 删除不包含ok的行，!符号表示取反
- `sed '/^2015/d' x.log`: 删除以2015开头的行
- `sed '/^$/d' x.log`: 删除所有空行
- `sed '/^$/{n;/^$/d}' x.log`: 删除重复的空行，连续两个空行只保留一个

### 替换文本
> 替换文本，vim中也是用这些命令, 只是是`:`后加命令。

- `sed 's/old/new/' x.log`: 将每行中的第一个old替换成new
- `sed 's/old/new/5' x.log`: 将每行中的第5个old替换成new
- `sed 's/old/new/g' x.log`: 将每行的old都替换成new
- `sed 's/old//g x.log`: 删除所有的old(用空来替换)
- `sed 's/old/&test/g' x.log`: 讲所有的old替换成`oldtest`,`&`表示查找的字符串
- `sed '5,10s/^/#/' x.py`: 将5-10行的代码注释掉(行首加#号)
- `sed 's/^#print/print/' x.py`: 取消#print开头的注释(去掉前面的#号)